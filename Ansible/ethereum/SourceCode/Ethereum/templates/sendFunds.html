{% extends 'template.html' %}

{% block pageTitle %}.::  Wallet : Send ETH ::.{% endblock %}

{% block pageHeader %}.:: Wallet : Send ETH ::.{% endblock %}

{% block cssLink %}

{% endblock %}



{% block jsLink %}


<script type = "text/javascript" src ="{{ url_for('static', filename = 'js/web3/web3.min.js') }}" ></script>

<script src="{{ url_for('static', filename = 'js/web3/keythereum.min.js') }}"  type="text/javascript"></script>

<script type = "text/javascript" src ="{{ url_for('static', filename = 'js/jquery-3.3.1.min.js') }}" ></script>

<script type = "text/javascript" src ="{{ url_for('static', filename = 'js/particles.js') }}" ></script>

<script src="{{ url_for('static', filename = 'js/sweetalert.min.js') }}"></script>

<script src="{{ url_for('static', filename = 'js/jquery.qrcode.js') }}"></script>
<script src="{{ url_for('static', filename = 'js/qrcode.js') }}"></script>

{% endblock %}

{% block content %}

<table class="tblProcess">
  <tr><td>You have : <span id="balance"></span><br><hr></td></tr>
<tr><td>To Address:</td></tr>
<tr>
<td>
<input class="txt" type="text" name="toAddress" id="txtToAddress" value="" />
</td>
</tr>
<tr><td>Amount (ETH):</td></tr>
<tr>
<td>
<input class="txt" type="text" name="amount" id="txtAmount" value="" />
</td>
</tr>
<tr><td>Gas Limit:</td></tr>
<tr>
<td>
<input class="txt" type="text" name="gasLimit" id="txtGasLimit" value="21000" />
</td>
</tr>

<tr>
<td>
  <table>
    <tr>
      <td>
      <input class="btn" type="button" name="btnSend" id="btnSend" value="Send by MetaMask" />
      </td>
      <td>
        <input class="btn" type="button" name="btnDirectSend" id="btnDirectSend" value="Send by Direct" />
        </td>
      </tr>
  </table>
  </td>
</tr>

</table>
{% endblock %}

{% block js %}
<script>
  function setCookie(cname, cvalue, exdays) {
      var d = new Date();
      d.setTime(d.getTime() + (exdays*24*60*60*1000));
      var expires = "expires="+ d.toUTCString();
      document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
  }
  function getCookie(cname) {
      var name = cname + "=";
      var decodedCookie = decodeURIComponent(document.cookie);
      var ca = decodedCookie.split(';');
      for(var i = 0; i <ca.length; i++) {
          var c = ca[i];
          while (c.charAt(0) == ' ') {
              c = c.substring(1);
          }
          if (c.indexOf(name) == 0) {
              return c.substring(name.length, c.length);
          }
      }
      return "";
  }
  function checkCookie() {
      var cpk = getCookie("cpk");
      var cadr = getCookie("cadr");
      if ( cadr != "" && cpk !="" ) {
          return true;
      } else {
          return false;
      }
  }

  if(!checkCookie()){
    document.location="./";
  }
</script>
<script>

particlesJS('particles-js',

{
"particles": {
"number": {
  "value": 80,
  "density": {
    "enable": true,
    "value_area": 800
  }
},
"color": {
  "value": "#ffffff"
},
"shape": {
  "type": "circle",
  "stroke": {
    "width": 0,
    "color": "#000000"
  },
  "polygon": {
    "nb_sides": 5
  },
  "image": {
    "src": "img/github.svg",
    "width": 100,
    "height": 100
  }
},
"opacity": {
  "value": 0.5,
  "random": false,
  "anim": {
    "enable": false,
    "speed": 1,
    "opacity_min": 0.1,
    "sync": false
  }
},
"size": {
  "value": 5,
  "random": true,
  "anim": {
    "enable": false,
    "speed": 40,
    "size_min": 0.1,
    "sync": false
  }
},
"line_linked": {
  "enable": true,
  "distance": 150,
  "color": "#ffffff",
  "opacity": 0.4,
  "width": 1
},
"move": {
  "enable": true,
  "speed": 6,
  "direction": "none",
  "random": false,
  "straight": false,
  "out_mode": "out",
  "attract": {
    "enable": false,
    "rotateX": 600,
    "rotateY": 1200
  }
}
},
"interactivity": {
"detect_on": "canvas",
"events": {
  "onhover": {
    "enable": true,
    "mode": "repulse"
  },
  "onclick": {
    "enable": true,
    "mode": "push"
  },
  "resize": true
},
"modes": {
  "grab": {
    "distance": 400,
    "line_linked": {
      "opacity": 1
    }
  },
  "bubble": {
    "distance": 400,
    "size": 40,
    "duration": 2,
    "opacity": 8,
    "speed": 3
  },
  "repulse": {
    "distance": 200
  },
  "push": {
    "particles_nb": 4
  },
  "remove": {
    "particles_nb": 2
  }
}
},
"retina_detect": true,
"config_demo": {
"hide_card": false,
"background_color": "#b61924",
"background_image": "",
"background_position": "50% 50%",
"background_repeat": "no-repeat",
"background_size": "cover"
}
}

);
var count_particles, stats, update;
$(document).ready(function(){
$("#particles-js").hide();
});
</script>


<script>

if (typeof web3 !== 'undefined') {
  web3 = new Web3(web3.currentProvider);
} else {
  web3 = new Web3(new Web3.providers.HttpProvider("https://rinkeby.infura.io/"));
}

var pK = getCookie('cpk');
Addr = keythereum.privateKeyToAddress(pK);
web3.eth.defaultAccount = Addr;

var pK = getCookie('cpk');
Addr = keythereum.privateKeyToAddress(pK);
web3.eth.defaultAccount = Addr;

$(document).ready(function(){
  $("#particles-js").hide();
  var addr =getCookie('cadr');
  var pk = getCookie('cpk');

  web3.eth.getBalance(addr,function(e,r){
      console.log(r);
      var tmp = r.c[0] /10000;
      $("#balance").html(tmp + " ETH");
  });

  $("#btnSend").click(function(e){
    $("#particles-js").show();
    $("#div-loading-text").html("Sending...");
    SendFundsByMetaMask();
  });
  function SendFundsByMetaMask(){
      web3.eth.sendTransaction(
          {
              to:$("#txtToAddress").val(), 
              from:addr, 
              value:web3.toWei($("#txtAmount").val(), "ether")
          },
          function(error,result){ //callback 
              if(!error){
                  alert("success");
                  $(".div-loading").hide();
              }
              else{
                  console.log(error);
                  $(".div-loading").hide();
              }
          }
      );
      $("#particles-js").hide();
      $("#div-loading-text").html("Loading...");
  }
  $("#btnDirectSend").click(function(e){
    $("#particles-js").show();
    $("#div-loading-text").html("Sending...");
    SendFundsByDirect();
  });
  function SendFundsByDirect(){
    var pk = getCookie('cpk');
    url = API + "SendFund";
    data = {
      wallet_private_key:pk,
      wallet_address:addr,
      toAddress:$("#txtToAddress").val(),
      amount_in_ether:$("#txtAmount").val(),
      gas:21000,
      gasPrice:50000000000,
      data:"",
    }
    $.post(url,data,function(data,status){
      //alert(status);
      //alert(data);
      console.log(data);
      if(data.status == false){
        swal({
					  title: 'Failed!',
					  html:data.message,
					  type: 'error',
					  showCancelButton: false,
					  });
      }
      else{
        data = data.data;
        tmpHtml = "<table width='100%' class='tbltransactionDetail' cellpadding='10'>"
        tmpHtml += "<tr><td> <b>BlockNumber</b> : </td><td> " + data.BlockNumber+"</td></tr>";
        tmpHtml += "<tr><td> <b>From</b> : </td><td>" + data.from+"</td></tr>";
        tmpHtml += "<tr><td> <b>To</b> : </td><td>" + data.to+"</td></tr>";
        tmpHtml += "<tr><td> <b>TransactionHash</b> : </td><td>" + data.transactionHash+"</td></tr>";
        tmpHtml += "<tr><td> <b>Status</b> : </td><td>" + data.status+"</td></tr>";
        tmpHtml += "<tr><td> <b>Value</b> : </td><td>" + data.value+"</td></tr></table>";
        swal({
					  title: 'Success!',
					  html:tmpHtml,
					  type: 'success',
            customClass: 'swal-wide',
					  showCancelButton: false,
					  });
      }
      $("#particles-js").hide();
      $("#div-loading-text").html("Loading...");
    });
  }

});
 
</script>

<style>
  .swal-wide{
    width:650px !important;
  }
  .tbltransactionDetail{
    display:block;
    font-size:13px;
  }
  .tbltransactionDetail tbody {
    display:block;
  }
  
  .tbltransactionDetail tbody tr td {
    line-height: 30px;
    padding:5px;
  }

  .tbltransactionDetail tbody td:nth-child(even){
        text-align:left;
    }
  .tbltransactionDetail tbody td:nth-child(odd){
    text-align:right;
  }

  .tbltransactionDetail tbody tr:nth-child(odd){
        background-color:#4e515d;
        color:#fff;
    }
  .tbltransactionDetail tbody tr:nth-child(even){
      background-color:#cadcdb73;
      
      color:#000;
  }
  
</style>
{% endblock %}